<!doctype html>
<html lang="de">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin – Zahlung buchen</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<body style="font-family: system-ui; max-width: 520px; margin: 24px auto;">
  <h1>Admin</h1>
  <div id="auth">
    <input id="email" placeholder="E-Mail" style="width:100%;padding:8px" />
    <input id="pass" type="password" placeholder="Passwort" style="width:100%;padding:8px;margin-top:8px" />
    <button id="login" style="margin-top:8px">Login</button>
    <div id="authMsg"></div>
  </div>

  <div id="panel" style="display:none">
    <label>Account-ID (UUID aus Accounts)
      <input id="accountId" style="width:100%;padding:8px" />
    </label>
    <div style="margin-top:8px">
      <button data-amt="2000">+20 €</button>
      <button data-amt="5000">+50 €</button>
      <button data-amt="10000">+100 €</button>
    </div>
    <div style="margin-top:8px">
      <input id="custom" type="number" placeholder="Betrag in Cent" />
      <button id="book">Buchen</button>
    </div>
    <div style="margin-top:8px">
      <select id="method">
        <option>Bar</option>
        <option>Überweisung</option>
      </select>
    </div>
    <div id="msg" style="margin-top:12px"></div>
  </div>

<script>
  const supabase = window.supabase.createClient('YOUR_SUPABASE_URL','YOUR_ANON_KEY');

  document.getElementById('login').onclick = async () => {
    const { data, error } = await supabase.auth.signInWithPassword({
      email: document.getElementById('email').value,
      password: document.getElementById('pass').value
    });
    document.getElementById('authMsg').textContent = error ? error.message : 'Eingeloggt.';
    if (!error) { document.getElementById('auth').style.display='none'; document.getElementById('panel').style.display='block'; }
  };

  document.querySelectorAll('button[data-amt]').forEach(btn=>{
    btn.onclick = ()=>{ document.getElementById('custom').value = btn.getAttribute('data-amt'); };
  });

  document.getElementById('book').onclick = async () => {
    const acct = document.getElementById('accountId').value.trim();
    const amt = parseInt(document.getElementById('custom').value||'0',10);
    const method = document.getElementById('method').value;
    if (!acct || amt <= 0) { document.getElementById('msg').textContent = 'Account und Betrag prüfen.'; return; }
    const { data, error } = await supabase.rpc('admin_add_payment', { _account_id: acct, _amount_cents: amt, _method: method });
    if (error) { document.getElementById('msg').textContent = error.message; return; }
    const bal = data && data[0] ? data[0].new_balance_cents : 0;
    document.getElementById('msg').textContent = `Zahlung erfasst. Neuer Stand: ${(bal/100).toFixed(2)} €`;
  };
</script>
</body>
</html>
